<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Unit | JLMS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAaNDRralbB3_Ybbivz9E1QrOmk3VMlCN4",
      authDomain: "jlms-teaching-platform.firebaseapp.com",
      projectId: "jlms-teaching-platform",
      storageBucket: "jlms-teaching-platform.appspot.com",
      messagingSenderId: "193970336189",
      appId: "1:193970336189:web:17572a6b9176a984a5a2d4",
      measurementId: "G-DDG3NTYVQS"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body class="bg-gray-50 text-gray-800 font-['Noto Sans TC'] p-4">

  <!-- Header -->
  <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-2 sm:gap-0">
    <div>
      <span id="status" class="block text-sm sm:text-base">Checking login...</span>
      <button id="logoutBtn" class="mt-1 bg-gray-600 text-white px-4 py-1 rounded hover:bg-gray-700 transition hidden">Logout</button>
    </div>
    <h1 class="text-2xl font-bold text-left sm:text-right w-full sm:w-auto" id="unit-title">Loading...</h1>
  </header>

  <div class="md:flex gap-6">
    <!-- Sidebar / Dropdown -->
    <aside class="md:w-1/4 mb-6 md:mb-0">
      <div class="block md:hidden mb-4">
        <label for="unit-dropdown" class="block mb-1 font-semibold">S√©lectionner une le√ßon :</label>
        <select id="unit-dropdown" class="w-full border p-2 rounded"></select>
      </div>
      <div id="unit-list" class="hidden md:block space-y-2"></div>
    </aside>

    <!-- Main Content -->
    <main class="md:w-3/4" id="unit-content">
      <div class="bg-[#50afaf] text-white rounded-xl p-4 mb-6 flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-6 text-lg">
        <a href="resources.html" class="hover:underline">‚Üê Back to course overview</a>
        <div class="flex gap-4">
          <a href="#" id="prevBtn" class="bg-white text-[#50afaf] px-4 py-2 rounded hover:bg-gray-100 transition">Previous Lesson</a>
          <a href="#" id="nextBtn" class="bg-white text-[#50afaf] px-4 py-2 rounded hover:bg-gray-100 transition">Next Lesson ‚Üí</a>
        </div>
      </div>

      <!-- YouTube -->
      <div class="flex justify-center mb-6">
        <div id="youtube-preview" class="w-full max-w-[640px] aspect-video mx-auto"></div>
      </div>

      <!-- PDFs -->
      <div class="space-y-6">
        <div id="pdf-tr" class="hidden max-w-[768px] mx-auto">
          <h2 class="font-semibold text-lg mb-2">üìÑ PDF (Traditionnel)</h2>
          <iframe class="w-full h-[640px] border rounded" id="iframe-tr" src=""></iframe>
          <a id="download-tr" href="#" class="text-blue-600 hover:underline block mt-1" download>Download PDF</a>
        </div>
        <div id="pdf-sim" class="hidden max-w-[768px] mx-auto">
          <h2 class="font-semibold text-lg mb-2">üìÑ PDF (Simplifi√©)</h2>
          <iframe class="w-full h-[640px] border rounded" id="iframe-sim" src=""></iframe>
          <a id="download-sim" href="#" class="text-blue-600 hover:underline block mt-1" download>Download PDF</a>
        </div>
      </div>
    </main>
  </div>

  // PDF Âà§Êñ∑ÈÇèËºØ
const canDownload = (currentLesson["ÊòØÂê¶ÂèØ‰∏ãËºâ(Downloadable)"] || "").toLowerCase().trim() !== "no";

// ÂÇ≥Áµ± PDF
const trId = currentLesson["PDFÊ™îÊ°àID (traditionnel)"];
const trBlock = document.getElementById("pdf-tr");
const trFrame = document.getElementById("iframe-tr");
const trLink = document.getElementById("download-tr");

if (trId) {
  trBlock.classList.remove("hidden");
  trFrame.src = `https://drive.google.com/file/d/${trId}/preview`;
  if (canDownload) {
    trLink.href = `https://drive.google.com/uc?export=download&id=${trId}`;
    trLink.textContent = "Download PDF";
  } else {
    trLink.textContent = "üìå This material is view-only and not available for download. / Ce mat√©riel est uniquement consultable en ligne et ne peut pas √™tre t√©l√©charg√©.";
    trLink.removeAttribute("href");
    trLink.removeAttribute("download");
  }
} else {
  trBlock.classList.remove("hidden");
  trBlock.innerHTML = `<p class="text-gray-600">üìå No document available. / Aucun document disponible.</p>`;
}

// Á∞°È´î PDF
const simId = currentLesson["PDFÊ™îÊ°àID (simplifi√©)"];
const simBlock = document.getElementById("pdf-sim");
const simFrame = document.getElementById("iframe-sim");
const simLink = document.getElementById("download-sim");

if (simId) {
  simBlock.classList.remove("hidden");
  simFrame.src = `https://drive.google.com/file/d/${simId}/preview`;
  if (canDownload) {
    simLink.href = `https://drive.google.com/uc?export=download&id=${simId}`;
    simLink.textContent = "Download PDF";
  } else {
    simLink.textContent = "üìå This material is view-only and not available for download. / Ce mat√©riel est uniquement consultable en ligne et ne peut pas √™tre t√©l√©charg√©.";
    simLink.removeAttribute("href");
    simLink.removeAttribute("download");
  }
} else {
  simBlock.classList.remove("hidden");
  simBlock.innerHTML = `<p class="text-gray-600">üìå No document available. / Aucun document disponible.</p>`;
}

  
        // ‰∏ä‰∏ÄË™≤ / ‰∏ã‰∏ÄË™≤ÈÇèËºØ
        const currentIndex = filtered.findIndex(row => row[idKey] === lessonId);
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
  
        if (currentIndex > 0) {
          const prevId = filtered[currentIndex - 1][idKey];
          prevBtn.onclick = () => {
            location.href = `unit.html?id=${encodeURIComponent(prevId)}&cat=${encodeURIComponent(cat || '')}&level=${encodeURIComponent(level || '')}`;
          };
        } else {
          prevBtn.classList.add("opacity-50", "pointer-events-none");
        }
  
        if (currentIndex < filtered.length - 1) {
          const nextId = filtered[currentIndex + 1][idKey];
          nextBtn.onclick = () => {
            location.href = `unit.html?id=${encodeURIComponent(nextId)}&cat=${encodeURIComponent(cat || '')}&level=${encodeURIComponent(level || '')}`;
          };
        } else {
          nextBtn.classList.add("opacity-50", "pointer-events-none");
        }
      });
  </script>
  